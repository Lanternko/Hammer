# 🏗️ Roguelike Numerical Showdown - MVP 分層架構設計

## 📊 整體架構樹狀圖

```
project/
├── index.html              # 主要 HTML 入口頁面，載入遊戲資源
├── main.js                 # 遊戲主入口，初始化並啟動遊戲
└── src/
    ├── game/
    │   ├── GameManager.js  # 遊戲總控，管理關卡與狀態
    │   ├── Player.js       # 玩家英雄邏輯，包含屬性與行為
    │   └── Enemy.js        # 敵人邏輯，包含屬性與生成
    ├── systems/
    │   ├── BattleSystem.js # 戰鬥系統，處理 frame 結算與傷害
    │   └── EventSystem.js  # 事件系統，處理商店與隨機事件
    ├── ui/
    │   └── UIManager.js    # UI 管理，渲染畫面與互動
    ├── storage/
    │   └── StorageManager.js # 存儲管理，使用 localStorage
    └── data/
        ├── badges.js       # 徽章數據，純數值配置
        └── enemies.js      # 敵人數據，包含基礎屬性與膨脹公式
```

## 🔄 依賴流向圖

```
主入口 (main.js)
    ↓ 引用並初始化
總控層 (GameManager.js)
    ↓ 引用
系統層 (BattleSystem.js, EventSystem.js)
    ↓ 引用
實體層 (Player.js, Enemy.js)
    ↓ 引用
UI 層 (UIManager.js) & 存儲層 (StorageManager.js)
    ↓ 引用
數據層 (badges.js, enemies.js)
```

## 📋 各層職責說明

### 1. 主入口 (Ultra Light - < 50 lines)
- **職責**: 載入資源、初始化遊戲、處理全局事件。
- **特點**: 極簡，僅負責啟動 GameManager。
- **修改頻率**: 很少。

### 2. 總控層 (Light - 50-100 lines each)
- **職責**: 管理遊戲狀態、關卡進度 (20 關)、金幣與鑽石結算。
- **特點**: 協調系統，不含戰鬥細節。
- **修改頻率**: 大版本更新時。

### 3. 系統層 (Medium - 100-200 lines each)
- **職責**: 實現核心機制，如 20 frames/秒 戰鬥結算 (先防御後減傷) 與事件/商店邏輯。
- **特點**: 通用計算，不依賴具體徽章或敵人數據。
- **修改頻率**: 中等 (新機制時)。

### 4. 實體層 (Medium - 50-150 lines each)
- **職責**: 定義玩家英雄 (巨鎚屬性) 與敵人行為 (血量膨脹)。
- **特點**: 處理屬性更新與傷害接收。
- **修改頻率**: 經常 (新增英雄或敵人類型)。

### 5. UI 層 (Light - 100-150 lines)
- **職責**: 使用 Canvas 渲染血條、攻速進度條、傷害數字。
- **特點**: 視覺呈現，無邏輯計算。
- **修改頻率**: 中等 (UI 優化時)。

### 6. 存儲層 (Ultra Light - < 50 lines)
- **職責**: 存取 localStorage (英雄解鎖、鑽石)。
- **特點**: 純 JSON 操作。
- **修改頻率**: 很少。

### 7. 數據層 (Pure Data)
- **職責**: 存放徽章效果、敵人基礎屬性 (血量 = 基礎 × (1 + 關卡/5))。
- **特點**: 無邏輯，易調整平衡。
- **修改頻率**: 經常 (平衡調整)。

## 🎯 擴展場景示例

### 場景1: 新增徽章 "攻速提升"
```javascript
// 只需修改 data/badges.js
// 例如: { name: 'SpeedBoost', effect: { attackSpeed: 0.2 } }
// 無需改其他文件
```

### 場景2: 新增敵人類型 "真實傷害"
```javascript
// 修改 Enemy.js 新增屬性
// 更新 data/enemies.js 基礎數據
// 無需改系統層
```

### 場景3: 平衡調整敵人血量
```javascript
// 只改 data/enemies.js
// 例如: HIGH_SPEED_BASE_HP: 60 → 70
// 測試後完成
```

## 🏗️ 實際文件大小預估

| 層級 | 文件數量 | 單文件行數 | 總行數預估 |
|------|----------|------------|------------|
| 主入口 | 1 | 20-50 | 50 |
| 總控層 | 1 | 50-100 | 100 |
| 系統層 | 2 | 100-200 | 400 |
| 實體層 | 2 | 50-150 | 300 |
| UI 層 | 1 | 100-150 | 150 |
| 存儲層 | 1 | <50 | 50 |
| 數據層 | 2 | 50-100 | 200 |
| **總計** | **10** | - | **1250** |

## 🔧 開發工作流程

### 日常調整平衡 (80%的工作)
1. 修改 `data/` 中的數值 (徽章、敵人)。
2. 測試戰鬥。
3. 完成！🛠️

### 新機制開發 (15%的工作)
1. 更新 `systems/` (如 BattleSystem.js 新增真實傷害)。
2. 修改相關實體層。
3. 更新數據層。

### UI 優化 (5%的工作)
1. 修改 `ui/UIManager.js` 動畫或顯示。
2. 測試渲染。
3. 完成！

## 🎨 代碼風格約定

- 主入口: 只初始化，不寫邏輯。
- 總控層: 狀態管理，無細節計算。
- 系統層: 通用公式，如傷害結算。
- 實體層: 屬性與方法分明。
- UI 層: 純渲染，使用 Canvas。
- 存儲層: 簡單 JSON 操作。
- 數據層: 純對象，便於熱更新。

這種架構確保：
- ✅ **平衡調整**: 只動數據層。
- ✅ **新增機制**: 只動系統層。
- ✅ **易維護**: 層級清晰，MVP 輕量。
- ✅ **擴展性**: 未來加英雄時僅改實體層。